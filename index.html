<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gráficos Comparativos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      overflow-y: auto;
    }

    .container {
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 700px;
      width: 100%;
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
    }

    select {
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
      width: 100%;
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
    }

    #chartContainer, #chartContainer2, #chartContainer3, #chartContainer4 {
      margin-top: 20px;
      max-height: 700px;
      overflow-y: auto;
    }

    canvas {
      max-width: 100%;
      height: auto;
    }

    .field-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }

    label {
      font-size: 18px;
      color: #555;
      width: 40%;
      text-align: right;
      margin-right: 10px;
    }

    select, input {
      padding: 10px;
      font-size: 16px;
      width: calc(60% - 22px);
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      color: white;
      background-color: #36a2eb;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    table, th, td {
      border: 1px solid #ddd;
    }

    th, td {
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    input[type="file"] {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Registro de Reclamações</h1>

    <div class="field-container">
      <label for="data">Data:</label>
      <input type="date" id="data">
    </div>

    <div class="field-container">
      <label for="cliente2">Cliente:</label>
      <input type="text" id="cliente2">
    </div>

    <div class="field-container">
      <label for="nBobina">Nº da Bobina:</label>
      <input type="text" id="nBobina">
    </div>

    <div class="field-container">
      <label for="nFardos">Nº dos Fardos:</label>
      <input type="text" id="nFardos">
    </div>

    <div class="field-container">
      <label for="nCaixa">Nº da Caixa:</label>
      <input type="text" id="nCaixa">
    </div>

    <div class="field-container">
      <label for="defeito">Defeito Liberado:</label>
      <input type="text" id="defeito">
    </div>

    <div class="field-container">
      <label for="setorOrigem">Setor de Origem:</label>
      <select id="setorOrigem">
        <option value="Laminação">Laminação</option>
        <option value="Impressão">Impressão</option>
        <option value="Acabamento Sacaria">Acabamento Sacaria</option>
        <option value="Acabamento Sacaria Soldada">Acabamento Sacaria Soldada</option>
        <option value="Tecelagem">Tecelagem</option>
        <option value="Outros">Outros</option>
      </select>
    </div>

    <div class="field-container">
      <label for="foto">Anexar Foto:</label>
      <input type="file" id="foto" accept="image/*">
    </div>

    <button onclick="salvarRegistro()">Salvar</button>
    <button onclick="downloadExcel()">Download Excel</button>

    <h2>Pesquisar Reclamações por Cliente</h2>
    <div class="field-container">
      <label for="consultaCliente">Nome do Cliente:</label>
      <input type="text" id="consultaCliente" oninput="pesquisarPorCliente()">
    </div>

    <table id="tabelaReclamacoes">
      <thead>
        <tr>
          <th>Data</th>
          <th>Cliente2</th>
          <th>Nº Bobina</th>
          <th>Nº Fardos</th>
          <th>Nº Caixa</th>
          <th>Defeito Liberado</th>
          <th>Setor Origem</th>
          <th>Foto</th>
        </tr>
      </thead>
      <tbody>
        <!-- Registros aparecerão aqui -->
      </tbody>
    </table>
  </div>

  <script>
    const reclamacoes = [];

    function salvarRegistro() {
      const data = document.getElementById('data').value;
      const cliente2 = document.getElementById('cliente2').value;
      const nBobina = document.getElementById('nBobina').value;
      const nFardos = document.getElementById('nFardos').value;
      const nCaixa = document.getElementById('nCaixa').value;
      const defeito = document.getElementById('defeito').value;
      const setorOrigem = document.getElementById('setorOrigem').value;
      const fotoInput = document.getElementById('foto');
      let fotoURL = '';

      if (fotoInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = function(event) {
          fotoURL = event.target.result;
          reclamacoes.push({ data, cliente2, nBobina, nFardos, nCaixa, defeito, setorOrigem, fotoURL });
          atualizarTabela();
        };
        reader.readAsDataURL(fotoInput.files[0]);
      } else {
        reclamacoes.push({ data, cliente2, nBobina, nFardos, nCaixa, defeito, setorOrigem, fotoURL });
        atualizarTabela();
      }
    }

    function atualizarTabela() {
      const tabela = document.getElementById('tabelaReclamacoes').getElementsByTagName('tbody')[0];
      tabela.innerHTML = '';

      reclamacoes.forEach(reclamacao => {
        const row = tabela.insertRow();
        row.insertCell(0).textContent = reclamacao.data;
        row.insertCell(1).textContent = reclamacao.cliente2;
        row.insertCell(2).textContent = reclamacao.nBobina;
        row.insertCell(3).textContent = reclamacao.nFardos;
        row.insertCell(4).textContent = reclamacao.nCaixa;
        row.insertCell(5).textContent = reclamacao.defeito;
        row.insertCell(6).textContent = reclamacao.setorOrigem;

        const cellFoto = row.insertCell(7);
        if (reclamacao.fotoURL) {
          const img = document.createElement('img');
          img.src = reclamacao.fotoURL;
          img.width = 50;
          cellFoto.appendChild(img);
        }
      });
    }

    function downloadExcel() {
      const wb = XLSX.utils.book_new();
      const ws_data = [
        ['Data', 'Cliente', 'Nº Bobina', 'Nº Fardos', 'Nº Caixa', 'Defeito Liberado', 'Setor Origem', 'Foto']
      ];

      reclamacoes.forEach(reclamacao => {
        ws_data.push([reclamacao.data, reclamacao.cliente2, reclamacao.nBobina, reclamacao.nFardos, reclamacao.nCaixa, reclamacao.defeito, reclamacao.setorOrigem, reclamacao.fotoURL]);
      });

      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "Reclamações");
      XLSX.writeFile(wb, "reclamacoes.xlsx");
    }

    function pesquisarPorCliente() {
      const cliente = document.getElementById('consultaCliente').value.toLowerCase();
      const tabela = document.getElementById('tabelaReclamacoes').getElementsByTagName('tbody')[0];
      tabela.innerHTML = '';

      reclamacoes
        .filter(reclamacao => reclamacao.cliente2.toLowerCase().includes(cliente))
        .forEach(reclamacao => {
          const row = tabela.insertRow();
          row.insertCell(0).textContent = reclamacao.data;
          row.insertCell(1).textContent = reclamacao.cliente2;
          row.insertCell(2).textContent = reclamacao.nBobina;
          row.insertCell(3).textContent = reclamacao.nFardos;
          row.insertCell(4).textContent = reclamacao.nCaixa;
          row.insertCell(5).textContent = reclamacao.defeito;
          row.insertCell(6).textContent = reclamacao.setorOrigem;

          const cellFoto = row.insertCell(7);
          if (reclamacao.fotoURL) {
            const img = document.createElement('img');
            img.src = reclamacao.fotoURL;
            img.width = 50;
            cellFoto.appendChild(img);
          }
        });
    }
  </script>
</body>
</html>
