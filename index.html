// Função para baixar os registros em Excel
function downloadExcel() {
  // Criar uma nova pasta de trabalho
  const wb = XLSX.utils.book_new();
  const wsData = [
    ["Data", "Cliente", "Nº Bobina", "Nº Fardos", "Nº Caixa", "Defeito Liberado", "Setor Origem", "Foto"],
  ];

  // Adiciona os dados à matriz
  registros.forEach(registro => {
    wsData.push([
      registro.data,
      registro.cliente,
      registro.nBobina,
      registro.nFardos,
      registro.nCaixa,
      registro.defeito,
      registro.setorOrigem,
      registro.foto, // Você pode usar o URL da imagem
    ]);
  });

  // Criar uma nova planilha
  const ws = XLSX.utils.aoa_to_sheet(wsData);

  // Adicionando as imagens
  registros.forEach((registro, index) => {
    if (registro.foto) {
      const img = new Image();
      img.src = registro.foto;

      img.onload = function() {
        const imgId = XLSX.utils.create_ssf().push({r: 0, c: 7, h: img.height, w: img.width});
        
        const imgObj = {
          t: 'z',
          v: registro.foto,
          r: imgId,
        };

        ws[`!objects`] = ws[`!objects`] || [];
        ws[`!objects`].push(imgObj);
      };
    }
  });

  // Adiciona a planilha à pasta de trabalho
  XLSX.utils.book_append_sheet(wb, ws, "Reclamações");

  // Faz o download do arquivo Excel
  XLSX.writeFile(wb, "reclamacoes.xlsx");
}
